@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthProvider
@inject CustomAuthProvider CustomAuth
@inject ProductosService productoService

<AuthorizeView>
    <Authorized Context="auth">
        <div class="sidebar">
            <nav class="nav flex-column p-3 bg-light min-vh-100">
                <h5 class="mb-4">Menú</h5>

                <NavLink class="nav-link" href="/Dashboards/Dashboard" Match="NavLinkMatch.All">
                    <i class="oi oi-home"></i> Dashboard
                </NavLink>

                <NavLink class="nav-link" href="/Productos/ProductosList">
                    <i class="oi oi-box"></i> Productos
                </NavLink>

                <NavLink class="nav-link" href="/Categorias/CategoriasList">
                    <i class="oi oi-tags"></i> Categorías
                </NavLink>

                <NavLink class="nav-link" href="/Entradas/EntradasList">
                    <i class="oi oi-arrow-thick-bottom"></i> Entradas
                </NavLink>

                <NavLink class="nav-link" href="/Salidas/SalidasList">
                    <i class="oi oi-arrow-thick-top"></i> Salidas
                </NavLink>

                <NavLink class="nav-link" href="/Productos/AlertaStock">
                    <i class="oi oi-warning"></i> Alerta Stock (@bajoStockCount)
                </NavLink>

                <NavLink class="nav-link" href="/PerfilyConfiguracion/PerfilUsuario">
                    <i class="oi oi-person"></i> Mi Perfil
                </NavLink>

                @if (auth.User.IsInRole("Admin"))
                {
                    <NavLink class="nav-link" href="/Usuarios/UsuariosList">
                        <i class="oi oi-people"></i> Usuarios
                    </NavLink>
                }

                <button class="btn btn-outline-danger mt-4" @onclick="CerrarSesion">
                    <i class="oi oi-account-logout"></i> Cerrar sesión
                </button>
            </nav>
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private int bajoStockCount = 0;

    protected override async Task OnInitializedAsync()
    {
        var productos = await productoService.ObtenerTodosAsync();
        bajoStockCount = productos.Count(p => p.Stock <= 5);
    }

    private void CerrarSesion()
    {
        CustomAuth.CerrarSesion();
        Navigation.NavigateTo("/Autenticacion/Login", true);
    }
}





@*
<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="">ControlDeInventarios</a>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    <div class="nav-item px-3">
        <NavLink class="nav-link" href="/Login">
            <span class="bi bi-plus-square-fill-nav-menu" aria-hidden="true"></span> Login
        </NavLink>
    </div>
</div>

*@